/*! grapesjs-rulers - 1.0.13 */
!function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports["grapesjs-rulers"]=t():e["grapesjs-rulers"]=t()}('undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}function s(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e.r(t),e.d(t,{default:()=>c});class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.api=this.builder(),this.utils=r,this.canvasPointerEvents=e.canvas.style.pointerEvents,this.options=e,this.api.constructRulers(e)}builder(){let e,t=1,n=2,i=0,s=0,o=0,r=0,l=1,a={},c=[],u=document.createElement('div'),d=[],p={rulerHeight:15,fontFamily:'arial',fontSize:'8px',strokeStyle:'gray',sides:['top','left'],cornerSides:['TL'],lineWidth:1,enableMouseTracking:!0,enableToolTip:!0,unit:'mm',dpi:96};const g=(e,t)=>{const n='rotate('+t+'deg)',i=this.utils.pixelize(Math.abs(parseInt(e.canvas.style.left)))+' 100%';e.canvas.style.webkitTransform=n,e.canvas.style.MozTransform=n,e.canvas.style.OTransform=n,e.canvas.style.msTransform=n,e.canvas.style.transform=n,e.canvas.style.webkitTransformOrigin=i,e.canvas.style.MozTransformOrigin=i,e.canvas.style.OTransformOrigin=i,e.canvas.style.msTransformOrigin=i,e.canvas.style.transformOrigin=i},f=(e,t)=>{switch(e.canvas.style.left=this.utils.pixelize(-(e.canvas.width/2-e.canvas.height)),t){case'top':e.orgPos=parseInt(e.canvas.style.left);break;case'left':e.canvas.style.top=this.utils.pixelize(-e.canvas.height-1),e.orgPos=parseInt(e.canvas.style.top),g(e,90)}},h=(n,a,d,p,g)=>{let f;let h=document.createElement('div'),y=n===t?'rul_lineVer':'rul_lineHor',v=n===t?i:s;h.title='Double click to delete',h.dataset.id=c.length,this.utils.addClasss(h,['rul_line',y]),h=u.appendChild(h),n===t?(h.style.left=this.utils.pixelize(a-e.container.getBoundingClientRect().left),g&&(h.style.left=this.utils.pixelize(Math.round(a/l+e.rulerHeight-o)))):(h.style.top=this.utils.pixelize(d-e.container.getBoundingClientRect().top),g&&(h.style.top=this.utils.pixelize(Math.round(d/l+e.rulerHeight-r)))),c.push({dimension:n,line:this.guideLine(h,e.container.querySelector('.rul_wrapper'),n,e,v,function(n,i,s){const o=n.dimension===t?i:s;n.assigned()?o<e.rulerHeight&&(c.some(function(e,t){if(e.line===n)return f=t,!0}),n.destroy(),c.splice(f,1)):o>e.rulerHeight&&n.assigned(!0)},p,l)})},y=(i,s)=>{let o,r='left'===s||'right'===s?t:n,l=r===t?'rul_ruler_Vertical':'rul_ruler_Horizontal',c=document.createElement('canvas');this.utils.addClasss(c,['rul_ruler',l,'rul_align_'+s]),o=i.appendChild(c),a[s]=this.rulerConstructor(o,e,r),a[s].drawRuler(i.offsetWidth,e.rulerHeight),f(a[s],s),((e,t)=>{const n=function(e){h(t.dimension,e.clientX,e.clientY,e)};t.canvas.addEventListener('mousedown',n),t.clearListeners=function(){t.canvas.removeEventListener('mousedown',n)}})(0,a[s])},v=(()=>{const t=(t,n)=>{const i=document.createElement('div'),s='rul_corner'+n.toUpperCase();return i.title='Clear Guide lines',this.utils.addClasss(i,['rul_corner',s,e.cornerIcon]),i.style.width=this.utils.pixelize(e.rulerHeight+1),i.style.height=this.utils.pixelize(e.rulerHeight),i.style.lineHeight=this.utils.pixelize(e.rulerHeight),t.appendChild(i)};function n(e){e.stopPropagation(),C()}return function(e,i){i.forEach(function(i){const s=t(e,i);s.addEventListener('mousedown',n),s.destroy=function(){s.removeEventListener('mousedown',n),s.parentNode.removeChild(s)},d.push(s)})}})(),m=e=>{c.forEach(function(e){e.line.stopDrag()})},b=e=>{let t=0;for(let n in a)a.hasOwnProperty(n)&&e(a[n],t++)},C=()=>{c.forEach(function(e){e.line.destroy()}),c=[]};return{VERTICAL:t,HORIZONTAL:n,getPos:()=>({x:i,y:s}),setPos:e=>{let o,r=0,l=0,a=0;b(n=>{n.dimension===t?(o=n.canvas.style.top,n.canvas.style.top=this.utils.pixelize(n.orgPos+parseInt(e.y)),a=parseInt(o)-parseInt(n.canvas.style.top)):(r=n.canvas.style.left,n.canvas.style.left=this.utils.pixelize(n.orgPos+parseInt(e.x)),l=parseInt(r)-parseInt(n.canvas.style.left))}),c.forEach(t=>{t.dimension===n?(t.line.guideLine.style.top=this.utils.pixelize(parseInt(t.line.guideLine.style.top)-a),t.line.curPosDelta(parseInt(e.y))):(t.line.guideLine.style.left=this.utils.pixelize(parseInt(t.line.guideLine.style.left)-l),t.line.curPosDelta(parseInt(e.x)))}),i=parseInt(e.x),s=parseInt(e.y)},setScroll:e=>{o=e.x,r=e.y},setScale:t=>{let o,r,a;b(function(e){e.context.clearRect(0,0,e.canvas.width,e.canvas.height),e.context.beginPath(),e.setScale(t),e.context.stroke(),l=t}),c.forEach(l=>{l.dimension===n?(o=parseInt(l.line.guideLine.style.top),r=e.rulerHeight+1,a=parseFloat(t)/l.line.curScale(),l.line.guideLine.style.top=this.utils.pixelize((o-r-s)/a+r+s),l.line.curScale(t)):(o=parseInt(l.line.guideLine.style.left),r=e.rulerHeight+1,a=parseFloat(t)/l.line.curScale(),l.line.guideLine.style.left=this.utils.pixelize((o-r-i)/a+r+i),l.line.curScale(t))})},clearGuides:C,removeGuide:e=>{const t=c.length-1;[c[e],c[t]]=[c[t],c[e]],c.pop()},getGuides:()=>c.map(function(t){return{posX:Math.round((parseInt(t.line.guideLine.style.left)-e.rulerHeight+o)*l),posY:Math.round((parseInt(t.line.guideLine.style.top)-e.rulerHeight+r)*l),dimension:t.dimension}}),setGuides:e=>{e&&e.length&&e.forEach(function(e){h(e.dimension,e.posX,e.posY,null,!0)})},constructRulers:t=>{u=this.utils.addClasss(u,'rul_wrapper'),e=this.utils.extend(p,t),u=e.container.appendChild(u),e.sides.forEach(function(e){y(u,e)}),v(u,e.cornerSides),e.container.addEventListener('mouseup',m)},toggleRulerVisibility:t=>{const n=t?'block':'none';u.style.display=n;const i=e.container.querySelectorAll('.rul_tracker');i.length>0&&(i[0].style.display=n,i[1].style.display=n)},toggleGuideVisibility:e=>{const t=e?'show':'hide';c.forEach(function(e){e.line[t]()})},destroy:()=>{C(),b(function(e){e.destroy()}),d.forEach(function(e){e.destroy()}),e.container.removeEventListener('mouseup',m),u.parentNode.removeChild(u)}}}rulerConstructor(e,t,n){let i=e,s=i.getContext('2d'),o=0,r=0,l=1,a=n||2,c=document.createElement('div');const u=()=>l,d=()=>{let e=0,n='',i=0,a=!1,c=0,u=o/2,d=o/2;for(let p=0;p<=r;p+=1){i=r/2-p,a=!1,n='';const g=Math.round(Math.abs(i)*l),f=()=>t.dpi/25.4,h=e=>e/f();let y;y='px'===t.unit?g:'cm'===t.unit?Math.round(h(g)/10):Math.round(h(g)),('px'===t.unit?i%50==0:Math.round(h(g))%10==0)?(e=c,n=y,a=!0):('px'===t.unit?i%25==0:Math.round(h(g))%5==0)?(e=u,a=!0):('px'===t.unit?i%5==0:Math.round(h(g))%1==0)&&(e=d,a=!0),a&&(s.moveTo(p+.5,o+.5),s.lineTo(p+.5,e+.5),s.fillText(n,p+1.5,o/2+1))}},p=e=>{let n=e.clientX,i=e.clientY;if('IFRAME'===e.target.tagName){const t=u()**-1;n=n*t+e.target.getBoundingClientRect().left,i=i*t+e.target.getBoundingClientRect().top}2===a?c.style.left=this.utils.pixelize(n-t.container.getBoundingClientRect().left):c.style.top=this.utils.pixelize(i-t.container.getBoundingClientRect().top)},g=()=>{c=t.container.appendChild(c),this.utils.addClasss(c,'rul_tracker');const e=this.utils.pixelize(t.rulerHeight);2===a?c.style.height=e:c.style.width=e,t.container.addEventListener('mousemove',p)};return t.enableMouseTracking&&g(),{getLength:()=>r,getThickness:()=>o,getScale:u,setScale:e=>(l=parseFloat(e),d(),l),dimension:a,orgPos:0,canvas:i,context:s,drawRuler:(e,n,a)=>{r=i.width=4*e,o=i.height=n,l=a||l,s.strokeStyle=t.strokeStyle,s.fillStyle=t.fillStyle,s.font=t.fontSize+' '+t.fontFamily,s.lineWidth=t.lineWidth,s.beginPath(),d(),s.stroke()},drawPoints:d,destroy:()=>{t.container.removeEventListener('mousemove',p),c.parentNode.removeChild(c),this.clearListeners&&this.clearListeners()}}}guideLine(e,t,n,i,s,o,r,l){let a,c=e,u=l||1,d=!1,p=s||0,g=t,f=n||2,h=o||function(){};const y=(()=>({cv:()=>this.options.canvas,move:(e,t)=>{c.style.left=this.utils.pixelize(e),c.style.top=this.utils.pixelize(t),m(e,t),h(a,e,t)},startMoving:e=>{y.cv().style.pointerEvents='none',this.utils.addClasss(c,['rul_line_dragged']);let t=(e=e||window.event)?e.clientX:0,n=e?e.clientY:0,s=parseInt(c.style.top||0),o=parseInt(c.style.left||0),r=parseInt(c.offsetWidth),l=parseInt(c.offsetHeight),a=parseInt(g.offsetWidth),u=parseInt(g.offsetHeight),d=2===f?'ns-resize':'ew-resize';i.container.style.cursor=d,c.style.cursor=d;let p=t-o,h=n-s;document.onmousemove=function(e){let t=(e=e||window.event).clientX,n=e.clientY,i=t-p,s=n-h;i<0&&(i=0),s<0&&(s=0),i+r>a&&(i=a-r),s+l>u&&(s=u-l),y.move(i,s)},v()},stopMoving:()=>{y.cv().style.pointerEvents=this.canvasPointerEvents,i.container.style.cursor=null,c.style.cursor=null,document.onmousemove=function(){},b(),this.utils.removeClasss(c,['rul_line_dragged'])}}))(),v=e=>{i.enableToolTip&&this.utils.addClasss(c,'rul_tooltip')},m=(e,t)=>{const n=e=>{if('px'===i.unit)return e+'px';const t=i.dpi/25.4;return'cm'===i.unit?"".concat((e/t/10).toFixed(1).replace(/\.0$/,''),"cm"):"".concat(Math.round(e/t),"mm")};if(t){const e=Math.round((t-i.rulerHeight-1-p)*u);c.dataset.tip=n(e)}else{const t=Math.round((e-i.rulerHeight-1-p)*u);c.dataset.tip=n(t)}},b=e=>{this.utils.removeClasss(c,'rul_tooltip')},C=()=>{y.stopMoving(),h=null,c.removeEventListener('mousedown',x),c.removeEventListener('mouseup',w),c.removeEventListener('dblclick',S),c.parentNode&&c.parentNode.removeChild(c)},x=e=>{e.stopPropagation(),y.startMoving()},w=e=>{y.stopMoving()},S=e=>{e.stopPropagation(),C(),this.api.removeGuide(c.dataset.id)};return c.addEventListener('mousedown',x),c.addEventListener('mouseup',w),c.addEventListener('dblclick',S),r&&y.startMoving(r),a={setAsDraggable:y,startDrag:y.startMoving,stopDrag:y.stopMoving,destroy:C,curScale:e=>void 0===e?u:u=e,assigned:e=>void 0===e?d:d=e,curPosDelta:e=>void 0===e?p:p=e,guideLine:c,dimension:f,hide:()=>{c.style.display='none'},show:()=>{c.style.display='block'}},a}}const r={extend(){for(let e=1;e<arguments.length;e++)for(let t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]},pixelize:e=>e+'px',prependChild:(e,t)=>e.insertBefore(t,e.firstChild),addClasss:(e,t)=>(t instanceof Array||(t=[t]),t.forEach(function(t){e.className+=' '+t}),e),removeClasss(e,t){let n=e.className;return t instanceof Array||(t=[t]),t.forEach(function(e){n=n.replace(e,'')}),e.className=n,e}};function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=a(a({},{dragMode:'translate',rulerHeight:15,canvasZoom:94,rulerOpts:{unit:'mm',dpi:96}}),t),i=e.Commands,s=n.rulerHeight,r=e.getConfig('dragMode');let l,c=n.canvasZoom,u=100/c,d=null,p=null,g=null;i.add('ruler-visibility',{run(e){!l&&(l=new o(a({container:e.Canvas.getCanvasView().el,canvas:e.Canvas.getFrameEl(),rulerHeight:s,strokeStyle:'white',fillStyle:'white',cornerIcon:'fa fa-trash'},n.rulerOpts)))&&e.on('canvasScroll frame:scroll change:canvasOffset',()=>{f()}),e.Rulers=l,l.api.toggleRulerVisibility(!0),e.Canvas.setZoom(c),e.setDragMode(n.dragMode),f(),l.api.setScale(u),!d&&e.Canvas&&'function'==typeof e.Canvas.setZoom&&(d=e.Canvas.setZoom.bind(e.Canvas),e.Canvas.setZoom=function(t){const n=d(t);try{c=t||e.Canvas.getZoom(),u=100/c,f(),l&&l.api.setScale(u)}catch(e){console.warn('grapesjs-rulers: failed to update rulers on zoom',e)}return n}),p=()=>{try{c=e.Canvas.getZoom(),u=100/c,f(),l&&l.api.setScale(u)}catch(e){}},e.on('canvas:zoom',p),g=()=>{try{c=e.Canvas.getZoom(),u=100/c,f(),l&&l.api.setScale(u)}catch(e){}},e.on('change:canvasZoom',g)},stop(e){l&&l.api.toggleRulerVisibility(!1),e.Canvas.setZoom(100),e.setDragMode(r),d&&e.Canvas&&(e.Canvas.setZoom=d,d=null),p&&(e.off('canvas:zoom',p),p=null),g&&(e.off('change:canvasZoom',g),g=null)}});const f=()=>{const{top:t,left:n}=e.Canvas.getOffset(),i=e.Canvas.getBody().scrollLeft,o=e.Canvas.getBody().scrollTop;l.api.setPos({x:n-s-i/u,y:t-s-o/u}),l.api.setScroll({x:i,y:o})};i.add('guides-visibility',{run(){l&&l.api.toggleGuideVisibility(!0)},stop(){l&&l.api.toggleGuideVisibility(!1)}}),i.add('get-rulers',()=>l),i.add('get-rulers-constructor',()=>o),i.add('clear-guides',()=>{l&&l.api.clearGuides()}),i.add('get-guides',()=>l?l.api.getGuides():0),i.add('set-guides',function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};l&&n.guides&&l.api.setGuides(n.guides)}),i.add('set-zoom',function(e,t){c=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).zoom,u=100/c,e.Canvas.setZoom(c),f(),l&&l.api.setScale(u)}),i.add('destroy-ruler',()=>{l&&l.api.destroy()})};return t})());
//# sourceMappingURL=index.js.map